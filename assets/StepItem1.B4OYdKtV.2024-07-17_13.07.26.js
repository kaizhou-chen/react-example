import{r as p,R as v,j as e}from"./index.BrOU8kF2.2024-07-17_13.07.26.js";import{F as d}from"./index.DG572AB0.2024-07-17_13.07.26.js";import{P as h}from"./index.fgg_eeEo.2024-07-17_13.07.26.js";import{I as x}from"./index.B25wwpkj.2024-07-17_13.07.26.js";import{B as j}from"./button.kbuo58lb.2024-07-17_13.07.26.js";import{R as y}from"./PlusOutlined.BE6guevJ.2024-07-17_13.07.26.js";import{R as I}from"./MinusOutlined.DLA3Q-Wj.2024-07-17_13.07.26.js";import"./ContextIsolator.jou7OEYE.2024-07-17_13.07.26.js";import"./main.wSUdYRL3.2024-07-17_13.07.26.js";import"./Compact.BJPWkux8.2024-07-17_13.07.26.js";import"./useSize.Mkc5EJPT.2024-07-17_13.07.26.js";import"./index.D4DUPUtk.2024-07-17_13.07.26.js";import"./collapse.BbEVqHco.2024-07-17_13.07.26.js";import"./index.dHOrQlX9.2024-07-17_13.07.26.js";import"./reactNode.Bzjc-udL.2024-07-17_13.07.26.js";import"./row.CUPMH57i.2024-07-17_13.07.26.js";import"./responsiveObserver.BL93-3DH.2024-07-17_13.07.26.js";import"./QuestionCircleOutlined.C5N0rY7R.2024-07-17_13.07.26.js";import"./KeyCode.DNlgD2sM.2024-07-17_13.07.26.js";import"./PurePanel.rGsoA93c.2024-07-17_13.07.26.js";import"./index.BrJrhQY9.2024-07-17_13.07.26.js";import"./compact-item.5orumCwJ.2024-07-17_13.07.26.js";import"./BaseInput.DnJyTj8i.2024-07-17_13.07.26.js";import"./useVariants.BaxuxDmC.2024-07-17_13.07.26.js";import"./pickAttrs.C5syKbSf.2024-07-17_13.07.26.js";import"./EyeInvisibleOutlined.Cr1nxYLV.2024-07-17_13.07.26.js";import"./EyeOutlined.B8FK5jOy.2024-07-17_13.07.26.js";import"./SearchOutlined.liVZuIOG.2024-07-17_13.07.26.js";function F(){const[l,r]=p.useState(),[s,o]=p.useState(!1),[n,a]=p.useState(null),m={email:[{required:!0,message:"请输入邮箱"},{type:"email",message:"邮箱格式不正确"},{validator:u}],alias:[{required:!0,message:"请输入别名"},{validator:t}],domain:[{required:!0,message:"域名不能为空"}]};function u(f,i){if(!i||i.trim()==="")return Promise.resolve();const c=i.split("@")[1];return(c?c.substring(0,c.lastIndexOf(".")):"").toLowerCase()==="gmail"?Promise.reject("不支持GMail"):Promise.resolve()}function t(f,i){return!i||i.trim()===""?(r("error"),Promise.resolve()):s&&l!=="validating"&&n!==null?(r(n?"success":"error"),n?Promise.resolve():Promise.reject("别名已被使用")):(r("validating"),new Promise((c,g)=>{setTimeout(()=>{i==="test"?(a(!1),r("error"),g("别名已被使用")):(a(!0),r("success"),c(!0))},2e3)}))}return{rules:m,fieldValidating:l,setFormValidating:o}}const C={autoComplete:"off",labelCol:{style:{width:100}},wrapperCol:{span:21}},_=v.forwardRef((l,r)=>{const[s]=d.useForm(),{rules:o,fieldValidating:n,setFormValidating:a}=F();function m(){return new Promise((t,f)=>{a(!0),s.validateFields().then(()=>t(!0)).catch(()=>t(!1)).finally(()=>a(!1))})}p.useEffect(()=>{const t=[{domain:""}];s.setFieldValue("domains",t)},[]),p.useImperativeHandle(r,()=>({validate:m}));function u(){return e.jsxs("ul",{style:{paddingInlineStart:"20px"},children:[e.jsx("li",{children:"失去焦点后，开始校验"}),e.jsx("li",{children:"输入 test，会在2秒后提示别名已被使用"})]})}return e.jsx("div",{style:{width:"600px",margin:"0 auto"},children:e.jsxs(d,{form:s,...C,children:[e.jsx(h,{title:"自定义校验",content:"输入 gmail 邮箱，会提示不支持",placement:"right",trigger:"focus",color:"#000",overlayClassName:"ux-dark",children:e.jsx(d.Item,{label:"邮箱",name:"email",rules:o.email,validateTrigger:"onBlur",children:e.jsx(x,{})})}),e.jsx(h,{title:"异步校验",content:u(),placement:"right",trigger:"focus",color:"#000",overlayClassName:"ux-dark",children:e.jsx(d.Item,{label:"别名",name:"alias",rules:o.alias,validateTrigger:"onBlur",hasFeedback:!0,validateStatus:n,children:e.jsx(x,{})})}),e.jsx(P,{name:"domains",getItems:(t,f,i)=>e.jsx(d.Item,{label:"域名"+(t+1),name:[f,"domain"],rules:o.domain,...i,children:e.jsx(x,{})})})]})})});function P(l){return e.jsx(d.List,{name:l.name,children:(r,{add:s,remove:o},{errors:n})=>e.jsx(e.Fragment,{children:r.map(({key:a,name:m,...u},t)=>e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{flex:"1"},children:l.getItems(t,m,u)}),e.jsxs("div",{children:[e.jsx(j,{onClick:()=>s(),style:{margin:"0px 8px"},children:e.jsx(y,{})}),e.jsx(j,{onClick:()=>o(m),children:e.jsx(I,{})})]})]},a))})})}export{_ as default};
